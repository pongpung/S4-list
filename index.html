<script type="module">
    // Import the Firebase libraries
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC4TgtyWDRx0tSJivj7HjGD0B0HzSA3OFw",
        authDomain: "list-b85eb.firebaseapp.com",
        projectId: "list-b85eb",
        storageBucket: "list-b85eb.appspot.com",
        messagingSenderId: "680439191018",
        appId: "1:680439191018:web:d31174e0c67d933a1b4e93"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const entriesRef = ref(database, "entries");

    const dataForm = document.getElementById("dataForm");
    const entriesList = document.getElementById("entriesList");
    const savedList = document.querySelector(".saved-list");
    const showEntriesButton = document.getElementById("showEntriesButton");
    const hideEntriesButton = document.getElementById("hideEntriesButton");

    // Function to display entries in ascending order by ID
    function displayEntries(entries) {
        entriesList.innerHTML = "";

        // Convert entries object into an array and sort by ID
        const sortedEntries = Object.entries(entries).sort(
            ([, entryA], [, entryB]) => parseInt(entryA.id) - parseInt(entryB.id)
        );

        sortedEntries.forEach(([key, entry]) => {
            const li = document.createElement("li");
            li.innerHTML = `
                <span>${entry.id}, ${entry.name}</span>
                <div class="actions">
                    <button onclick="editEntry('${key}')">Edit</button>
                    <button class="delete-button" onclick="deleteEntry('${key}')">Delete</button>
                </div>
            `;
            entriesList.appendChild(li);
        });
    }

    // Function to add a new entry
    dataForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const id = document.getElementById("id").value.trim();
        const name = document.getElementById("name").value.trim();

        // Validate input: Ensure ID and name are not empty
        if (!id || !name) {
            alert("Both ID and Name are required.");
            return;
        }

        // Add entry to the Firebase database
        const newEntryRef = push(entriesRef);
        set(newEntryRef, { id, name });

        // Reset the form after submission
        dataForm.reset();
    });

    // Function to edit an entry
    window.editEntry = (key) => {
        const idField = document.getElementById("id");
        const nameField = document.getElementById("name");

        onValue(ref(database, `entries/${key}`), (snapshot) => {
            const entry = snapshot.val();
            idField.value = entry.id;
            nameField.value = entry.name;
        });

        dataForm.onsubmit = (e) => {
            e.preventDefault();

            const newId = idField.value.trim();
            const newName = nameField.value.trim();

            // Validate input: Ensure ID and name are not empty
            if (!newId || !newName) {
                alert("Both ID and Name are required.");
                return;
            }

            update(ref(database, `entries/${key}`), { id: newId, name: newName });

            dataForm.reset();
            dataForm.onsubmit = defaultSubmitHandler;
        };
    };

    // Function to delete an entry
    window.deleteEntry = (key) => {
        remove(ref(database, `entries/${key}`));
    };

    // Default form submission handler
    const defaultSubmitHandler = (e) => {
        e.preventDefault();

        const id = document.getElementById("id").value.trim();
        const name = document.getElementById("name").value.trim();

        // Validate input: Ensure ID and name are not empty
        if (!id || !name) {
            alert("Both ID and Name are required.");
            return;
        }

        const newEntryRef = push(entriesRef);
        set(newEntryRef, { id, name });

        dataForm.reset();
    };

    dataForm.onsubmit = defaultSubmitHandler;

    // Listen for changes in the database
    onValue(entriesRef, (snapshot) => {
        const entries = snapshot.val();
        displayEntries(entries || {});
    });

    // Show Entries button functionality
    showEntriesButton.addEventListener("click", () => {
        savedList.style.display = "block";
        showEntriesButton.style.display = "none";
        hideEntriesButton.style.display = "inline-block";
    });

    // Hide Entries button functionality
    hideEntriesButton.addEventListener("click", () => {
        savedList.style.display = "none";
        showEntriesButton.style.display = "inline-block";
        hideEntriesButton.style.display = "none";
    });
</script>
